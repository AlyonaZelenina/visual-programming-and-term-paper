# MQ integration

### модуль асинхронной итерации микропроцесоров на основе Massage Oriented брокера NATS Streaming Server
Это слой обмена слообщениями между сервисами на базе Message Queue NATS




### Техническая история (Technical Story)
1. Отправка сообщений от сервиса в MQ
    * At least Once delivery - гарантия доставки (один раз или больше) *
2. Доставлять из MQ к сервису
    * Group delivery (когда только один микросервси из кгрууппы должен успешно обработать сообщение)
    * Broadcast delivery (когда сообщение доставляется всем заинтересованным сервисам) *
3. Асинхронная надёжная обработка сообщений сервисом
4. Асинхронная надёжная отправка сообщений сервисом

5. Все мессаджы делятся на две группы:
    * Facts - отправляются как уведомления, что состояние конкретного сервиса было изменено 
    * Commands - приказ микросервису что-то сделать (аналог вызова Web API но через очередь)
Для всех них нужно иметь строковые константы.
5а. Необходимо для каждого возможного эндпоинта генерировать сабжект (для отправки и получения сообщений - команд)
    * имя сервиса + хендлер
5б. Необходимо для каждого изменения состояния сервиса генерировать сабжект
    * имя сервиса + имя сущности + операция
6. сделать конфигруационную структуру, с настрйками к подлкючению к очереди
7. Пример broadcast и group обработки. 
~~7. сделать go интерфейс для очереди.~~






###План работ
1. NATS, NATS Streaming server
2. Взять за основу свой веб сервис и после сохранения сущности в базу, отпралять сообщение с сущностью в очередь. (At least Once delivery)
3. Реализовать cli tool,  которая может подписаться на конкретный топик (Broadcast delivery) и выводить месседжи в stdout.
4. Проектирование API.
